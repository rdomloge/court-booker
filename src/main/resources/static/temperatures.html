<html>
<head>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"
	integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	crossorigin="anonymous"></script>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
	google.charts.load('current', {packages: ['corechart']});
	google.charts.setOnLoadCallback(drawChart);

	
	function drawChart() {
		// Define the chart to be drawn.
		var data = new google.visualization.DataTable();
		data.addColumn('string', 'Element');
		data.addColumn('number', 'Pi Zero');
		
		// Set chart options
      	var options = {'title':'Temperature over time',
			'width':900,
			'height':300};

		// Instantiate and draw the chart.
		var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
		chart.draw(data, options);
		
		updateGraph(data, chart, options);
	}
	
	function updateGraph(data, chart, options) {
		var today = new Date();
		var yr = today.getFullYear();
		var mo = today.getMonth()+1;
		var da = today.getDate();
		var dateQ = yr+'-'+mo+'-'+da;
		
		$.getJSON("/temperatureReadings/search/findByTimeGreaterThanEqual?time="+dateQ, function(response) {
			var json = response._embedded.temperatureReadings;
			$("#stats").html(json.length+' points');
			console.log("Received: ", json);
			
			for (reading in json) {
				var date = new Date(json[reading].time);
				var pretty = date.getHours() + ':' + date.getMinutes();
				data.addRow([pretty, json[reading].temp]);
			}
			
			chart.draw(data, options);
		});
	}
</script>
</head>
<body>
	<div id="curve_chart" style="width: 900px; height: 300px"></div>
	<div id="stats" style="font-family: sans-serif; margin-left: 80px;"></div>
</body>
</html>